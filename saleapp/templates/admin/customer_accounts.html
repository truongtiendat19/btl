{% extends 'admin/base_admin.html' %}
{% block page_title %}Tài khoản khách hàng{% endblock %}

{% block content %}
<div class="container-fluid px-5 py-4">
    <div class="content-wrapper">
        <div class="row mb-4 justify-content-center">
            <div class="col-md-4">
                <div class="card text-dark bg-warning mb-3 text-center">
                    <div class="card-body">
                        <h5 class="card-title">Tài khoản mới (15 ngày)</h5>
                        <p class="card-text fs-4">{{ total_new_accounts }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-primary mb-3 text-center">
                    <div class="card-body">
                        <h5 class="card-title">Tổng số tài khoản</h5>
                        <p class="card-text fs-4">{{ total_accounts }}</p>
                    </div>
                </div>
            </div>
        </div>


        <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="input-group" style="max-width: 420px;">
                <input type="text" id="searchInput" class="form-control" placeholder="Tìm kiếm...">
                <button class="btn btn-outline-secondary" type="button" id="clearButton">❌</button>
            </div>

            <div class="d-flex align-items-center gap-2">
                <span class="badge bg-warning text-dark">Mới</span>
                <small class="text-muted">Tài khoản tạo trong 15 ngày</small>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-bordered text-center align-middle">
                <thead>
                <tr>
                    <th>STT</th>
                    <th>Họ tên</th>
                    <th>Tên đăng nhập</th>
                    <th>Email</th>
                    <th>Điện thoại</th>
                    <th>Số đơn đã mua</th>
                    <th>Tổng tiền đã mua</th>
                    <th>Ngày đăng ký</th>
                </tr>
                </thead>
                <tbody>
                {% for c in customers %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>
                        {{ c.name }}
                        {% if c.created_at and c.created_at >= new_threshold %}
                        <span class="badge bg-warning text-dark ms-1">Mới</span>
                        {% endif %}
                    </td>
                    <td>{{ c.username }}</td>
                    <td>{{ c.email or '-' }}</td>
                    <td>{{ c.phone or '-' }}</td>
                    <td>{{ c.total_orders }}</td>
                    <td>{{ "{:,.0f}".format(c.total_spent) }} đ</td>
                    <td>{{ c.created_at.strftime('%d/%m/%Y') if c.created_at else '-' }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="8">Chưa có khách hàng.</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    function filterTable() {
      const q = document.getElementById('searchInput').value.toLowerCase();
      const rows = document.querySelectorAll('.table tbody tr');
      rows.forEach(row => {
        const name = row.cells[1]?.innerText.toLowerCase() || '';
        const username = row.cells[2]?.innerText.toLowerCase() || '';
        const email = row.cells[3]?.innerText.toLowerCase() || '';
        row.style.display = (name.includes(q) || username.includes(q) || email.includes(q)) ? '' : 'none';
      });
    }
    document.getElementById('searchInput').addEventListener('keyup', filterTable);
    document.getElementById('clearButton').addEventListener('click', function() {
      document.getElementById('searchInput').value = '';
      filterTable();
    });
</script>
{% endblock %}
